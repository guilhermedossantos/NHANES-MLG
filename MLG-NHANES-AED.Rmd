---
title: "NHANES 2015-2016"
subtitle: "AED"
date: "18 de junho de 2019"
author: "Guilherme Santos e Isabelle Oliveira"
output: html_notebook
---

```{r}
library(foreign)
library(DataExplorer)
library(dplyr)
#knitr::opts_knit$set(root.dir = "F:\\NHANES")
```


## Dados

```{r}
demo <- read.xport("F:\\NHANES\\DEMO_I.XPT")
renda <- read.xport("F:\\NHANES\\INQ_I.XPT")
atvfisica <- read.xport("F:\\NHANES\\PAQ_I.XPT")
diabetes <- read.xport("F:\\NHANES\\DIQ_I.XPT")
cigarro <- read.xport("F:\\NHANES\\SMQRTU_I.XPT")
alcool <- read.xport("F:\\NHANES\\ALQ_I.XPT")
drogas <- read.xport("F:\\NHANES\\DUQ_I.XPT")
sono <- read.xport("F:\\NHANES\\SLQ_I.XPT")
peso <- read.xport("F:\\NHANES\\WHQ_I.XPT")
```

```{r}
dados <- inner_join(diabetes[,1:2], demo, by = "SEQN") %>% 
  inner_join(renda, by = "SEQN") %>% 
  inner_join(cigarro, by = "SEQN") %>% 
  inner_join(atvfisica, by = "SEQN") %>%
  inner_join(drogas, by = "SEQN") %>%
  inner_join(sono, by = "SEQN") %>%
  inner_join(peso, by = "SEQN") %>%
  mutate(DIQ010 = na_if(DIQ010, 9) %>%                                                   na_if(3)) %>% mutate(DIQ010 = ifelse(DIQ010 == 1, 1,0 ))
```

### Descri??o de vari?veis

  Acho que podemos come?ar com essas variáveis. Lembrando que precisa come?ar com no m?nimo 5. Pesquisei algumas coisas para justificar as escolhas delas (precisar estar no relat?rio). E, provavelmente, vamos reduzindo.

 - DIQ010: M?dico disse que O entrevistado tem diabetes (variav?l resposta);
 
 - RIDAGEYR: idade em anos na entrevista (acho que tem a ver com quanto mais velho maior a probabilidade ne, tem que achar algo para embasar isso)(um possivel: Diabetes em idosos: perfil s?cio-demogr?fico e uso de servi?os de sa?de; https://www.scielosp.org/scielo.php?pid=S0102-311X2010000100018&script=sci_arttext&tlng=en );
 
 - INDFMPIR: Raz?o entre a renda familiar e a pobreza ( os mais vuneraveis podem tender a ter mais tedencia <http://www.scielo.br/pdf/abc/v88n4/28.pdf/>);
 
 - RIAGENDR: Genero (homem tende a estar mais em risco <http://www.scielo.br/pdf/abc/v88n4/28.pdf/>);
 
 - DMDEDUC2: nivel educacional para maiores de 20 anos (acho que aqui tamb?m tem rela??o com desigualdades sociais);
 
 - PAQ715: Horas usando computador nos ultimos 30 dias (tem a ver com sedentarismo tambem);
 
 - INDFMMPC: Categoria de pobreza mensal familiar (acho que pode ter rela??o com desigualdades sociais);
 
 - SMQ681: fumou nos ?ltimos 5 dias.
 
 - SLQ030: Com que frequ?ncia voc? ronca?
 
 - SLQ300: Que horas voc? costuma dormir?
 
 - SLQ310: Que horas voc? costuma acordar?
 
 - WHD020: Peso autorrelatado atual (libras)
 
### AED

```{r}
dados %>% mutate(INQ320 = ifelse(INQ320 %in% c(66,77,99), NA, INQ320),
                 SLQ030 = ifelse(SLQ030 >= 7, NA, SLQ030),
                 DMDEDUC2 = ifelse(DMDEDUC2 >= 7, NA, DMDEDUC2),
                 WHD020 = ifelse(WHD020 >= 7777, NA, WHD020),
                 PAQ715 = ifelse(PAQ715 >= 7777, NA, PAQ715),
                 PAQ650 = ifelse(PAQ650 >= 7, NA, PAQ650)) -> dados

dados %>% select_if(~sum(!is.na(.)) > 100) -> dados
```

```{r}
dados %>%  
  rename(diabetes = DIQ010,
         idade_anos = RIDAGEYR,
         nivel_edu = DMDEDUC2,
         rz_rend_pobr = INDFMPIR,
         sexo = RIAGENDR,
         comp = PAQ715,
         tabaco_5d = SMQ681,
         drogas = DUQ200,
         ronco = SLQ030,
         peso = WHD020,
         horas_sono = SLD012,
         atv_recr_int = PAQ650
         ) %>% 
  select(diabetes, idade_anos, nivel_edu, rz_rend_pobr,
         sexo, comp, tabaco_5d, drogas, ronco,
         peso, horas_sono, atv_recr_int) %>% 
  mutate(diabetes = as.factor(diabetes),
         tabaco_5d = na_if(tabaco_5d, 7) %>%  na_if(9) %>%
                     factor(.,labels = c("Sim", "Não")),
         ronco = as.factor(ronco),
         nivel_edu = as.factor(nivel_edu), 
         drogas = ifelse(drogas >= 7, NA, drogas),
         marijuana = as.factor(drogas),
         comp = factor(comp, labels = c("<1",as.character(1:5), ">5", "0")),
         sexo = factor(sexo, labels = c("Maculino", "Feminino")),
         atv_recr_int = factor(atv_recr_int, 
                               labels = c("Sim", "Não"))) %>%   select(-drogas) -> dados

plot_intro(dados)
```

```{r}
# Removendo NA's
dados <- na.omit(dados)
```


```{r}
plot_histogram(dados)
```
```{r}
plot_boxplot(dados, by = "diabetes")    
```
  A variável que melhor parece discriminar é a idade, seguida do Peso.


```{r}
plot_bar(dados, order_bar = T)
```


```{r}
plot_correlation(dados)
```
  Correlações baixas no geral, observamos correlações altas somente entre as variáveis que são níveis diferentes do mesmo fator, e uma leve correlação entre marijuana e uso de tabaco.

```{r}
plot_qq(dados, by = "diabetes")
```


```{r}
# prov <- dados %>% 
#   select(idade_anos, diabetes, nivel_edu, rz_rend_pobr, sexo, comp, tabaco_5d) %>%
#   mutate(tabaco_5d = ifelse(tabaco_5d > 2, as.factor(NA), factor(tabaco_5d)),
#          nivel_edu = ifelse(nivel_edu > 5, NA, factor(nivel_edu)),
#          comp = na_if(comp, 99),
#          sexo = factor(sexo))
  
modelo1 <- glm(diabetes ~ ., family = binomial, data = dados)
summary(modelo1)
```
  
  Temos um modelo com muitas variáveis explicativas não significativas, o que não é o ideal.

```{r}
step(modelo1) -> modelo2
summary(modelo2)
```

```{r}
anova(modelo1, modelo2, test = "Chisq")
```




