---
title: "NHANES 2015-2016"
subtitle: "AED"
date: "18 de junho de 2019"
author: "Guilherme Santos e Isabelle Oliveira"
output: html_notebook
---

```{r}
library(foreign)
library(DataExplorer)
library(dplyr)
knitr::opts_knit$set(root.dir = "E:\\NHANES")
```


## Dados

```{r}
demo <- read.xport("E:\\NHANES\\DEMO_I.XPT")
renda <- read.xport("E:\\NHANES\\INQ_I.XPT")
atvfisica <- read.xport("E:\\NHANES\\PAQ_I.XPT")
diabetes <- read.xport("E:\\NHANES\\DIQ_I.XPT")
cigarro <- read.xport("E:\\NHANES\\SMQRTU_I.XPT")
alcool <- read.xport("E:\\NHANES\\ALQ_I.XPT")
drogas <- read.xport("E:\\NHANES\\DUQ_I.XPT")
sono <- read.xport("E:\\NHANES\\SLQ_I.XPT")
peso <- read.xport("E:\\NHANES\\WHQ_I.XPT")
```

```{r}
dados <- inner_join(diabetes[,1:2], demo, by = "SEQN") %>% 
  inner_join(renda, by = "SEQN") %>% 
  inner_join(cigarro, by = "SEQN") %>% 
  inner_join(atvfisica, by = "SEQN") %>%
  inner_join(drogas, by = "SEQN") %>%
  inner_join(sono, by = "SEQN") %>%
  inner_join(peso, by = "SEQN") %>%
  mutate(DIQ010 = na_if(DIQ010, 9) %>%                                                   na_if(3)) %>% mutate(DIQ010 = ifelse(DIQ010 == 1, 1,0 ))
```

### Descrição de variáveis

  Acho que podemos começar com essas variáveis. Lembrando que precisa começar com no mínimo 5. Pesquisei algumas coisas para justificar as escolhas delas (precisar estar no relatório). E, provavelmente, vamos reduzindo.

 - DIQ010: Médico disse que O entrevistado tem diabetes (variavél resposta);
 
 - RIDAGEYR: idade em anos na entrevista (acho que tem a ver com quanto mais velho maior a probabilidade ne, tem que achar algo para embasar isso)(um possivel: Diabetes em idosos: perfil sócio-demográfico e uso de serviços de saúde; https://www.scielosp.org/scielo.php?pid=S0102-311X2010000100018&script=sci_arttext&tlng=en );
 
 - INDFMPIR: Razão entre a renda familiar e a pobreza ( os mais vuneraveis podem tender a ter mais tedencia <http://www.scielo.br/pdf/abc/v88n4/28.pdf/>);
 
 - RIAGENDR: Genero (homem tende a estar mais em risco <http://www.scielo.br/pdf/abc/v88n4/28.pdf/>);
 
 - DMDEDUC2: nivel educacional para maiores de 20 anos (acho que aqui também tem relação com desigualdades sociais);
 
 - PAQ715: Horas usando computador nos ultimos 30 dias (tem a ver com sedentarismo tambem);
 
 - INDFMMPC: Categoria de pobreza mensal familiar (acho que pode ter relação com desigualdades sociais);
 
 - SMQ681: fumou nos últimos 5 dias.
 
 - SLQ030: Com que frequência você ronca?
 
 - SLQ300: Que horas você costuma dormir?
 
 - SLQ310: Que horas você costuma acordar?
 
 - WHD020: Peso autorrelatado atual (libras)
 
### AED

```{r}
dados %>% mutate(INQ320 = ifelse(INQ320 %in% c(66,77,99), NA, INQ320),
                 SLQ030 = ifelse(SLQ030 >= 7, NA, SLQ030),
                 DMDEDUC2 = ifelse(DMDEDUC2 >= 7, NA, DMDEDUC2),
                 WHD020 = ifelse(WHD020 >= 7777, NA, WHD020),
                 PAQ715 = ifelse(PAQ715 >= 7777, NA, PAQ715)) -> dados

dados %>% select_if(~sum(!is.na(.)) > 300) -> dados
```

```{r}
dados %>%  
  rename(diabetes = DIQ010,
         idade_anos = RIDAGEYR,
         nivel_edu = DMDEDUC2,
         rz_rend_pobr = INDFMPIR,
         sexo = RIAGENDR,
         comp = PAQ715,
         tabaco_5d = SMQ681,
         drogas = DUQ200,
         ronco = SLQ030,
         peso = WHD020,
         horas_sono = SLD012
         ) %>% 
  select(diabetes, idade_anos, nivel_edu, rz_rend_pobr,
         sexo, comp, tabaco_5d, drogas, ronco,
         peso, horas_sono) %>% 
  mutate(diabetes = as.factor(diabetes),
         tabaco_5d = na_if(tabaco_5d, 7) %>%  na_if(9) %>%
                     factor(.,labels = c("Sim", "Não")),
         ronco = as.factor(ronco),
         nivel_edu = as.factor(nivel_edu), 
         marijuana = as.factor(drogas),
         comp = factor(comp, labels = c("<1",as.character(1:5), ">5", "0"))) %>%   select(-drogas) -> dados

plot_intro(dados)
```

```{r}
# Removendo NA's
dados <- na.omit(dados)
```


```{r}
plot_histogram(dados)
```

```{r}
plot_bar(dados)
```

```{r}
plot_correlation(dados)
```
  Correlações baixas no geral, observamos correlações altas somente entre as variáveis que são níveis diferentes do mesmo fator, e uma leve correlação entre marijuana e uso de tabaco.
  
```{r}
plot_boxplot(dados, by = "diabetes")    
```

```{r}
plot_qq(dados, by = "diabetes")
```


```{r}

prov <- dados %>% 
  select(idade_anos, diabetes, nivel_edu, rz_rend_pobr, sexo, comp, tabaco_5d) %>%
  mutate(tabaco_5d = ifelse(tabaco_5d > 2, as.factor(NA), factor(tabaco_5d)),
         nivel_edu = ifelse(nivel_edu > 5, NA, factor(nivel_edu)),
         comp = na_if(comp, 99),
         sexo = factor(sexo))
  
modelo1 <- glm(diabetes ~ ., family = binomial, data = dados)
summary(modelo1)
```


